!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).RF=t()}(this,(function(){"use strict";return class{__functions=new Map;__awaiting={};constructor(e){this.__sendRaw=e,this.__ready=!1}prepare(){return new Promise(((e,t)=>{this.__ready?e():this.__readyIndicator={resolve:e,reject:t}}))}RFMessageReceived(e){e=JSON.parse(e),this.__dispatch(e.type,e.data)}__dispatch(e,t){({availableFuncs:()=>{t.forEach((e=>{this[e]=(...t)=>this.__callFunc(e,t)})),this.__ready=!0,this.__readyIndicator&&(this.__readyIndicator.resolve(),delete this.__readyIndicator)},functionResult:()=>{this.__awaiting[t.reqId]&&(this.__awaiting[t.reqId][t.resultType](t.result),delete this.__awaiting[t.reqId])},error:()=>{console.error(t)},callClientFunc:()=>{let{id:e,args:i}=t,r=this.__functions.get(e);r&&r(...i)}})[e]()}__send(e,t){this.__sendRaw(JSON.stringify({type:e,data:t}))}__callFunc(e,t){return new Promise(((i,r)=>{let s=Math.random().toString(16).substr(2);this.__send("callFunc",{fname:e,args:this.__serializeArgs(t),reqId:s}),this.__awaiting[s]={resolve:i,reject:r}}))}__serializeArgs(e){return e.map(this.__serializeArg)}__serializeArg=e=>{let t=this,i={object:()=>({type:"object",data:t.__serializeObject(e)}),function:function(){return{type:"function",data:t.__registerFunction(e)}}}[typeof e];return i?i():e};__serializeObject(e){return Object.entries(e).map(((e,t)=>this.__serializeArg(t))).reduce(((e,t)=>({...e,[t[0]]:t[1]})),{})}__registerFunction(e){let t,i=Array.from(this.__functions.entries()).find((t=>{let[,i]=t;return e==i}));return i?[t]=i:(t=Math.random().toString(16).substr(2),this.__functions.set(t,e)),t}}}));
